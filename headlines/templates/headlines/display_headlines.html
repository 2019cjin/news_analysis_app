{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>Keyword {{kw}}</title>

	<link rel="stylesheet" type="text/css" href="{% static 'headlines/autocomplete.css' %}">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

	<script src="{% static 'headlines/autocomplete_generator.js' %}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <style type="text/css">
    	#myInput{
    		width: 500px;
    	}
    	.control{
    		overflow-x: auto;
    	}
    </style>
</head>
<body>
	<div id = "navigation-bar">
      {% include 'headlines/navigation_bar.html' %}
    </div>
	
	<div class="container">

		<div class="form-inline">

			<input class="form-control" id="myInput" type="text" placeholder="Search.." value = "{{kw}}">
			<!-- Example single danger button -->
			<div class="btn-group">

				<label class="btn btn-primary" id = "news-source-label">Select News Source</label>
				
				<button id = "news-source-button" type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					&#9660
				</button>

				<ul class="dropdown-menu" id="news-source-dropdown">
					<li><a class="dropdown-item">ANY</a></li>
					<li role = "separator" class="divider"></li>
					{% for ns in newssources%}
						<li><a class="dropdown-item">{{ns}}</a></li>
					{% endfor %}
				</ul>
			</div>

			<div class="btn-group">
				<label class="btn btn-success" id="month-label">Month</label>
				<button id="month-button" type="button" class="btn btn-success dropdown-toggle" data-toggle = "dropdown" aria-haspopup = "true" aria-expanded="false">
					&#9660
				</button>

				<ul class="dropdown-menu" id = "month-dropdown">
					<li><a class="dropdown-item">ANY</a></li>
					<li role = "separator" class="divider"></li>
					{% for month in months %}
						<li><a class="dropdown-item">{{month}}</a></li>
					{% endfor %}
				</ul>
			</div>

			

        </div>

		<table class="table table-striped table-bordered">
			<thead>
				<tr>
					<th scope="col">#</th>
					<th scope="col">Headline</th>
					<th scope="col">News Source</th>
					<th scope="col">Date</th>
				</tr>	
			</thead>
			<tbody id = "table-headlines">
				{% for datum in headlines %}
					<tr>
						<th scope="row">{{forloop.counter}}</th>
						<td>{{datum.content}}</td>
						<td id = "news-source-column">{{datum.newssourceid.name}}</td>
						<td id = "month-column">{{datum.datetime.date}}</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
	

	<script>
		$(document).ready(function (){

			$("#myInput").on("keyup", function(){
				var val1 = $(this).val();
				$("#table-headlines tr").filter( function(){
					$(this).toggle($(this).text().indexOf(val1) > -1);
				});
			});

			$("#news-source-dropdown .dropdown-item").on("click", function(){
				var news_source = $(this).text();
				var word_search = $("#myInput").val();
				var month = $("#month-label").text();

				$("#table-headlines tr").filter( function (){
					$(this).toggle( 
						(news_source == "ANY" || $(this).children("#news-source-column").text()== news_source) && 
						(month == "Month" || $(this).children("#month-column").text().indexOf(month)>-1) && $(this).text().indexOf(word_search)>-1);
				});

				var label_text = news_source;
				if (news_source=="ANY") {
					label_text = "Select News Source";
				} 
				
				$("#news-source-label").text(label_text);
			});

			$("#month-dropdown .dropdown-item").on("click", function () {
				var month = $(this).text();
				var word_search = $("#myInput").val();
				var news_source = $("#news-source-label").text();

				$("#table-headlines tr").filter(function () {
					$(this).toggle(
						(news_source == "Select News Source" || $(this).children("#news-source-column").text() == news_source) &&
						(month == "ANY" || $(this).children("#month-column").text().indexOf(month) > -1) && $(this).text().indexOf(word_search)>-1);
				});

				var label_text = month;
				if (month == "ANY"){
					label_text = "Month";
				}

				$("#month-label").text(label_text)
			});



			$("#myInput").trigger("keyup");
		});

	</script>
</body>
</html>